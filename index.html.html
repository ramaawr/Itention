<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Itention - Platform Skrining ADHD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .pulse-gentle { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }
        .game-stimulus { 
            width: 80px; height: 80px; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; font-weight: bold; color: white;
            transition: all 0.1s ease;
        }
        .target { background: #28B8A6; }
        .distractor { background: #EF4444; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <div id="app" class="min-h-screen">
        <!-- Navigation -->
        <nav class="bg-white shadow-sm border-b">
            <div class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
               <div class="flex items-center space-x-2">
                   <img src="https://iili.io/Kze0qfS.png" alt="logo itention2" class="w-10 h-10">
                   <span class="text-xl font-semibold text-gray-800">Itention</span>
                </div>
                <div class="flex space-x-4">
                    <button onclick="showPage('home')" class="text-gray-600 hover:text-blue-400 transition-colors">Beranda</button>
                    <button onclick="showPage('history')" class="text-gray-600 hover:text-blue-400 transition-colors">Riwayat</button>
                    <button onclick="showPage('resources')" class="text-gray-600 hover:text-blue-400 transition-colors">Sumber Daya</button>
                </div>
            </div>
        </nav>

        <!-- Home Page -->
        <div id="home-page" class="page">
            <!-- Hero Section -->
            <div class="bg-gradient-to-br from-blue-600 via-blue-700 to-blue-800 text-white">
                <div class="max-w-6xl mx-auto px-4 py-20">
                    <div class="text-center fade-in">
                        <div class="inline-flex items-center bg-blue-500 bg-opacity-20 rounded-full px-4 py-2 mb-6">
                            <span class="text-blue-200 text-sm font-medium">✨ Platform Skrining ADHD Terpercaya</span>
                        </div>
                        <h1 class="text-5xl md:text-6xl font-bold mb-6 leading-tight">
                            Deteksi Dini ADHD<br>
                            <span class="text-blue-300">untuk Masa Depan Cerah</span>
                        </h1>
                        <p class="text-xl text-blue-100 mb-8 max-w-3xl mx-auto leading-relaxed">
                            Platform komprehensif yang menggabungkan kuesioner DSM-5 dan permainan berbasis Continuous Performance Test 
                            untuk memberikan skrining ADHD yang akurat dan mudah dipahami
                        </p>
                        <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
                            <button onclick="showAssessmentOptions()" class="bg-white text-blue-700 px-8 py-4 rounded-xl text-lg font-semibold hover:bg-blue-50 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                                🚀 Mulai Skrining Sekarang
                            </button>
                            <button onclick="showPage('resources')" class="border-2 border-blue-300 text-blue-100 px-8 py-4 rounded-xl text-lg font-semibold hover:bg-blue-600 transition-all duration-300">
                                📚 Pelajari Lebih Lanjut
                            </button>
                        </div>
                        <div class="mt-8 text-blue-200 text-sm">
                            ⏱️ Hanya membutuhkan 10-15 menit • 🔒 Data aman & privat • 📊 Hasil instan
                        </div>
                    </div>
                </div>
            </div>

            <!-- Assessment Options -->
            <div id="assessment-options" class="hidden bg-white py-16">
                <div class="max-w-4xl mx-auto px-4">
                    <div class="text-center mb-12">
                        <h2 class="text-3xl font-bold text-gray-800 mb-4">Pilih Jenis Skrining</h2>
                        <p class="text-gray-600">Anda dapat melakukan skrining lengkap atau memilih salah satu metode</p>
                    </div>
                    
                    <div class="grid md:grid-cols-3 gap-8">
                        <!-- Complete Assessment -->
                        <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl p-8 border-2 border-blue-200 relative overflow-hidden">
                            <div class="absolute top-4 right-4 bg-blue-600 text-white px-3 py-1 rounded-full text-sm font-medium">
                                Direkomendasikan
                            </div>
                            <div class="text-4xl mb-4">🎯</div>
                            <h3 class="text-xl font-bold text-gray-800 mb-3">Skrining Lengkap</h3>
                            <p class="text-gray-600 mb-6">Kombinasi kuesioner DSM-5 dan permainan Focus Catcher untuk hasil paling akurat</p>
                            <ul class="text-sm text-gray-600 mb-6 space-y-2">
                                <li class="flex items-center"><span class="text-green-500 mr-2">✓</span> Kuesioner 18 pertanyaan</li>
                                <li class="flex items-center"><span class="text-green-500 mr-2">✓</span> Permainan Focus Catcher</li>
                                <li class="flex items-center"><span class="text-green-500 mr-2">✓</span> Analisis komprehensif</li>
                                <li class="flex items-center"><span class="text-green-500 mr-2">✓</span> Rekomendasi tindakan</li>
                            </ul>
                            <button onclick="startCompleteAssessment()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold transition-colors">
                                Mulai Skrining Lengkap (12-15 menit)
                            </button>
                        </div>

                        <!-- Questionnaire Only -->
                        <div class="bg-white rounded-2xl p-8 border-2 border-gray-200 hover:border-blue-300 transition-colors">
                            <div class="text-4xl mb-4">📝</div>
                            <h3 class="text-xl font-bold text-gray-800 mb-3">Kuesioner Saja</h3>
                            <p class="text-gray-600 mb-6">Skrining berdasarkan kuesioner DSM-5 untuk evaluasi gejala ADHD</p>
                            <ul class="text-sm text-gray-600 mb-6 space-y-2">
                                <li class="flex items-center"><span class="text-green-500 mr-2">✓</span> 18 pertanyaan tervalidasi</li>
                                <li class="flex items-center"><span class="text-green-500 mr-2">✓</span> Analisis domain ADHD</li>
                                <li class="flex items-center"><span class="text-green-500 mr-2">✓</span> Hasil cepat</li>
                                <li class="flex items-center"><span class="text-gray-400 mr-2">○</span> Tanpa tes performa</li>
                            </ul>
                            <button onclick="startQuestionnaireOnly()" class="w-full bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-lg font-semibold transition-colors">
                                Mulai Kuesioner (5-7 menit)
                            </button>
                        </div>

                        <!-- Game Only -->
                        <div class="bg-white rounded-2xl p-8 border-2 border-gray-200 hover:border-blue-300 transition-colors">
                            <div class="text-4xl mb-4">🎮</div>
                            <h3 class="text-xl font-bold text-gray-800 mb-3">Focus Catcher Saja</h3>
                            <p class="text-gray-600 mb-6">Permainan interaktif untuk mengukur fokus dan konsistensi perhatian</p>
                            <ul class="text-sm text-gray-600 mb-6 space-y-2">
                                <li class="flex items-center"><span class="text-green-500 mr-2">✓</span> Tes performa kognitif</li>
                                <li class="flex items-center"><span class="text-green-500 mr-2">✓</span> Analisis waktu reaksi</li>
                                <li class="flex items-center"><span class="text-green-500 mr-2">✓</span> Pengalaman interaktif</li>
                                <li class="flex items-center"><span class="text-gray-400 mr-2">○</span> Tanpa kuesioner</li>
                            </ul>
                            <button onclick="startGameOnly()" class="w-full bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-lg font-semibold transition-colors">
                                Mulai Permainan (5-7 menit)
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Features Section -->
            <div class="bg-gray-50 py-16">
                <div class="max-w-6xl mx-auto px-4">
                    <div class="text-center mb-12">
                        <h2 class="text-3xl font-bold text-gray-800 mb-4">Mengapa Memilih Itention?</h2>
                        <p class="text-gray-600 max-w-2xl mx-auto">Platform kami dirancang khusus untuk memberikan skrining ADHD yang akurat, mudah digunakan, dan dapat diandalkan</p>
                    </div>

                    <div class="grid md:grid-cols-3 gap-8">
                        <div class="bg-white rounded-xl p-8 shadow-sm hover:shadow-md transition-shadow">
                            <div class="w-16 h-16 bg-blue-100 rounded-xl flex items-center justify-center mb-6">
                                <span class="text-3xl">🎯</span>
                            </div>
                            <h3 class="text-xl font-semibold text-gray-800 mb-3">Akurat & Tervalidasi</h3>
                            <p class="text-gray-600">Berdasarkan kriteria DSM-5 dan penelitian terkini dalam bidang ADHD</p>
                        </div>

                        <div class="bg-white rounded-xl p-8 shadow-sm hover:shadow-md transition-shadow">
                            <div class="w-16 h-16 bg-blue-100 rounded-xl flex items-center justify-center mb-6">
                                <span class="text-3xl">⚡</span>
                            </div>
                            <h3 class="text-xl font-semibold text-gray-800 mb-3">Cepat & Efisien</h3>
                            <p class="text-gray-600">Selesai dalam 10-15 menit dengan antarmuka yang ramah dan mudah dipahami</p>
                        </div>

                        <div class="bg-white rounded-xl p-8 shadow-sm hover:shadow-md transition-shadow">
                            <div class="w-16 h-16 bg-blue-100 rounded-xl flex items-center justify-center mb-6">
                                <span class="text-3xl">📊</span>
                            </div>
                            <h3 class="text-xl font-semibold text-gray-800 mb-3">Laporan Komprehensif</h3>
                            <p class="text-gray-600">Grafik detail, analisis mendalam, dan rekomendasi tindakan yang actionable</p>
                        </div>

                        <div class="bg-white rounded-xl p-8 shadow-sm hover:shadow-md transition-shadow">
                            <div class="w-16 h-16 bg-blue-100 rounded-xl flex items-center justify-center mb-6">
                                <span class="text-3xl">🔒</span>
                            </div>
                            <h3 class="text-xl font-semibold text-gray-800 mb-3">Privasi Terjamin</h3>
                            <p class="text-gray-600">Data Anda disimpan dengan aman dan dapat dihapus kapan saja sesuai keinginan</p>
                        </div>

                        <div class="bg-white rounded-xl p-8 shadow-sm hover:shadow-md transition-shadow">
                            <div class="w-16 h-16 bg-blue-100 rounded-xl flex items-center justify-center mb-6">
                                <span class="text-3xl">👨‍⚕️</span>
                            </div>
                            <h3 class="text-xl font-semibold text-gray-800 mb-3">berdasarkan penelitian profesional</h3>
                            <p class="text-gray-600">itention di buat berdasarkan data dari peneliti terpercaya</p>
                        </div>

                        <div class="bg-white rounded-xl p-8 shadow-sm hover:shadow-md transition-shadow">
                            <div class="w-16 h-16 bg-blue-100 rounded-xl flex items-center justify-center mb-6">
                                <span class="text-3xl">📱</span>
                            </div>
                            <h3 class="text-xl font-semibold text-gray-800 mb-3">Akses Mudah</h3>
                            <p class="text-gray-600">Dapat diakses di komputer, kapan saja dan dimana saja</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Statistics Section -->
            <div class="bg-blue-600 py-16">
                <div class="max-w-4xl mx-auto px-4">
                    <div class="text-center mb-12">
                        <h2 class="text-3xl font-bold text-white mb-4">Teruji oleh banyak Pengguna</h2>
                        <p class="text-blue-100">Platform Itention telah membantu banyak remaja dan keluarga</p>
                    </div>

                    <div class="grid md:grid-cols-4 gap-8 text-center">
                        <div>
                            <div class="text-4xl font-bold text-white mb-2">90+</div>
                            <p class="text-blue-200">Skrining Selesai</p>
                        </div>
                        <div>
                            <div class="text-4xl font-bold text-white mb-2">79%</div>
                            <p class="text-blue-200">Tingkat Kepuasan</p>
                        </div>
                        <div>
                            <div class="text-4xl font-bold text-white mb-2">100%</div>
                            <p class="text-blue-200">Gratis</p>
                        </div>
                        <div>
                            <div class="text-4xl font-bold text-white mb-2">24/7</div>
                            <p class="text-blue-200">Akses Platform</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CTA Section -->
            <div class="bg-white py-16">
                <div class="max-w-4xl mx-auto px-4 text-center">
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">Siap Memulai Skrining ADHD?</h2>
                    <p class="text-gray-600 mb-8 max-w-2xl mx-auto">
                        Dapatkan pemahaman yang lebih baik tentang kondisi ADHD dengan skrining yang mudah dan akurat
                    </p>
                    <button onclick="showAssessmentOptions()" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-4 rounded-xl text-lg font-semibold transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                        Mulai Skrining Gratis
                    </button>
                </div>
            </div>
        </div>

        <!-- Onboarding Page -->
        <div id="onboarding-page" class="page hidden">
            <div class="max-w-2xl mx-auto px-4 py-12">
                <div class="bg-white rounded-lg p-8 shadow-sm fade-in">
                    <h2 class="text-2xl font-semibold mb-6">Informasi Dasar</h2>
                    
                    <form id="onboarding-form" class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium mb-2">Nama Panggilan</label>
                            <input type="text" id="nickname" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-transparent" placeholder="Masukkan nama panggilan" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Umur</label>
                            <select id="age" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-transparent" required>
                                <option value="">Pilih umur</option>
                                <option value="6">6 tahun</option>
  <option value="7">7 tahun</option>
  <option value="8">8 tahun</option>
  <option value="9">9 tahun</option>
  <option value="10">10 tahun</option>
  <option value="11">11 tahun</option>
  <option value="12">12 tahun</option>
  <option value="13">13 tahun</option>
  <option value="14">14 tahun</option>
  <option value="15">15 tahun</option>
  <option value="16">16 tahun</option>
  <option value="17">17 tahun</option>
  <option value="18">18 tahun</option>
  <option value="19">19 tahun</option>
  <option value="20">20 tahun</option>
  <option value="21">21 tahun</option>
  <option value="22">22 tahun</option>
  <option value="23">23 tahun</option>
  <option value="24">24 tahun</option>
  <option value="25">25 tahun</option>
  <option value="26">26 tahun</option>
  <option value="27">27 tahun</option>
  <option value="28">28 tahun</option>
  <option value="29">29 tahun</option>
  <option value="30">30 tahun</option>
  <option value="31">31 tahun</option>
  <option value="32">32 tahun</option>
  <option value="33">33 tahun</option>
  <option value="34">34 tahun</option>
                            </select>
                        </div>

                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h3 class="font-semibold mb-3">Persetujuan Partisipasi</h3>
                            <div class="text-sm text-gray-700 space-y-2 mb-4">
                                <p>• Tes ini bertujuan untuk skrining dini ADHD, bukan diagnosis medis</p>
                                <p>• Data Anda akan disimpan secara anonim dan aman</p>
                                <p>• Anda dapat menghapus data kapan saja</p>
                                <p>• Hasil hanya bersifat indikatif dan perlu konfirmasi profesional</p>
                            </div>
                            <label class="flex items-center">
                                <input type="checkbox" id="consent" class="mr-3" required>
                                <span class="text-sm">Saya memahami dan menyetujui ketentuan di atas</span>
                            </label>
                        </div>

                        <button type="submit" class="w-full bg-blue-400 hover:bg-blue-500 text-white py-3 rounded-lg font-medium transition-colors">
                            Mulai Tes
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Questionnaire Page -->
        <div id="questionnaire-page" class="page hidden">
            <div class="max-w-3xl mx-auto px-4 py-8">
                <!-- Progress Bar -->
                <div class="mb-8">
                    <div class="flex justify-between text-sm text-gray-600 mb-2">
                        <span>Kuesioner DSM-5</span>
                        <span id="progress-text">1 dari 33</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="progress-bar" class="bg-blue-400 h-2 rounded-full transition-all duration-300" style="width: 5.5%"></div>
                    </div>
                </div>

                <div class="bg-white rounded-lg p-8 shadow-sm fade-in">
                    <div id="question-container">
                        <h3 id="question-text" class="text-xl font-medium mb-6"></h3>
                        <div id="answer-options" class="space-y-3"></div>
                    </div>
                    
                    <div class="flex justify-between mt-8">
                        <button id="prev-btn" onclick="previousQuestion()" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors" disabled>
                            Sebelumnya
                        </button>
                        <button id="next-btn" onclick="nextQuestion()" class="px-6 py-2 bg-blue-400 text-white rounded-lg hover:bg-blue-500 transition-colors" disabled>
                            Selanjutnya
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Page -->
        <div id="game-page" class="page hidden">
            <div class="max-w-4xl mx-auto px-4 py-8">
                <div id="game-instructions" class="bg-white rounded-lg p-8 shadow-sm text-center fade-in">
                    <h2 class="text-2xl font-semibold mb-4">Focus Catcher</h2>
                    <div class="max-w-2xl mx-auto space-y-4 text-gray-700">
                        <p>Sekarang Anda akan memainkan permainan untuk mengukur fokus dan perhatian.</p>
                        <div class="bg-teal-50 p-4 rounded-lg">
                            <h3 class="font-semibold mb-2">Cara Bermain:</h3>
                            <ul class="text-left space-y-1">
                                <li>• Lingkaran akan muncul di layar secara berurutan</li>
                                <li>• Tekan <kbd class="bg-gray-200 px-2 py-1 rounded">SPASI</kbd> saat melihat lingkaran <span class="inline-block w-4 h-4 bg-teal-500 rounded-full"></span> HIJAU</li>
                                <li>• JANGAN tekan apa-apa saat melihat lingkaran <span class="inline-block w-4 h-4 bg-red-500 rounded-full"></span> MERAH</li>
                                <li>• Berkonsentrasi dan bereaksi secepat mungkin</li>
                            </ul>
                        </div>
                        <p class="text-sm text-gray-600">Permainan terdiri dari 3 level dengan total durasi sekitar 5 menit.</p>
                    </div>
                    <button onclick="startGame()" class="mt-6 bg-teal-500 hover:bg-teal-600 text-white px-8 py-3 rounded-lg font-medium transition-colors">
                        Mulai Permainan
                    </button>
                </div>

                <div id="game-area" class="hidden">
                    <div class="text-center mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <span id="level-indicator" class="text-lg font-semibold">Level 1 - Pemanasan</span>
                            <span id="trial-counter" class="text-gray-600">Trial 1/20</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div id="game-progress" class="bg-teal-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg p-12 shadow-sm min-h-96 flex items-center justify-center">
                        <div id="stimulus-area" class="text-center">
                            <div id="fixation-cross" class="text-4xl font-bold text-gray-400 hidden">+</div>
                            <div id="stimulus" class="game-stimulus mx-auto hidden"></div>
                            <div id="feedback" class="mt-4 text-lg font-medium hidden"></div>
                        </div>
                    </div>

                    <div class="text-center mt-4">
                        <p class="text-gray-600">Tekan <kbd class="bg-gray-200 px-2 py-1 rounded">SPASI</kbd> untuk lingkaran hijau</p>
                    </div>
                </div>

                <div id="game-complete" class="hidden bg-white rounded-lg p-8 shadow-sm text-center fade-in">
                    <div class="text-6xl mb-4">🎉</div>
                    <h2 class="text-2xl font-semibold mb-4">Permainan Selesai!</h2>
                    <p class="text-gray-600 mb-6">Terima kasih telah menyelesaikan Focus Catcher. Sekarang mari lihat hasil Anda.</p>
                    <button onclick="showResults()" class="bg-blue-400 hover:bg-blue-500 text-white px-8 py-3 rounded-lg font-medium transition-colors">
                        Lihat Hasil
                    </button>
                </div>
            </div>
        </div>

        <!-- Results Page -->
        <div id="results-page" class="page hidden">
            <div class="max-w-6xl mx-auto px-4 py-8">
                <div class="text-center mb-8 fade-in">
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">Hasil Skrining ADHD</h1>
                    <p class="text-gray-600">Berikut adalah analisis komprehensif dari kuesioner dan permainan Focus Catcher</p>
                </div>

      <!-- Summary metrics -->
      <div class="bg-white p-6 rounded shadow mb-6">
        <div class="grid md:grid-cols-3 gap-6">
          <div class="text-center">
            <div class="text-2xl font-bold text-sky-600" id="inattention-score">0</div>
            <div class="text-sm text-gray-600">Skor Inatensi</div>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold text-orange-500" id="impulsivity-score">0</div>
            <div class="text-sm text-gray-600">Skor Impulsivitas</div>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold text-emerald-600" id="consistency-score">0</div>
            <div class="text-sm text-gray-600">Konsistensi Fokus</div>
          </div>
        </div>
      </div>

      <!-- Charts & domain results -->
      <div class="grid lg:grid-cols-2 gap-6 mb-6">
        <div class="bg-white p-6 rounded shadow">
          <h3 class="font-semibold mb-3">Profil Domain ADHD</h3>
          <div id="domainResults">
            <!-- Domain chart & explanation will be injected here by JS -->
            <div class="text-sm text-gray-500">(Chart akan muncul di sini setelah tes selesai)</div>
          </div>
        </div>
        <div class="bg-white p-6 rounded shadow">
          <h3 class="font-semibold mb-3">Performa Focus Catcher</h3>
          <canvas id="performanceChart" style="max-width:100%;max-height:320px"></canvas>
        </div>
      </div>


      <!-- Interpretation -->
      <div class="grid lg:grid-cols-2 gap-6 mb-6">
        <div class="bg-white p-6 rounded shadow">
          <h3 class="font-semibold mb-3">Interpretasi</h3>
          <div id="interpretation-content" class="text-sm text-gray-700"></div>
        </div>
        <div class="bg-white p-6 rounded shadow">
          <h3 class="font-semibold mb-3">Rekomendasi</h3>
          <div id="recommendations-content" class="text-sm text-gray-700"></div>
        </div>
      </div>

      <!-- Game stats -->
      <div class="bg-white p-6 rounded shadow mb-6">
        <h3 class="font-semibold mb-3">Statistik Permainan</h3>
        <div class="grid md:grid-cols-4 gap-4">
          <div class="p-3 bg-gray-50 rounded text-center">
            <div id="total-trials" class="font-bold text-lg">0</div>
            <div class="text-xs text-gray-500">Total Percobaan</div>
          </div>
          <div class="p-3 bg-green-50 rounded text-center">
            <div id="correct-hits" class="font-bold text-lg">0</div>
            <div class="text-xs text-gray-500">Respons Benar</div>
          </div>
          <div class="p-3 bg-red-50 rounded text-center">
            <div id="false-alarms" class="font-bold text-lg">0</div>
            <div class="text-xs text-gray-500">False Alarm</div>
          </div>
          <div class="p-3 bg-blue-50 rounded text-center">
            <div id="avg-reaction-time" class="font-bold text-lg">0ms</div>
            <div class="text-xs text-gray-500">Rata-rata RT</div>
          </div>
        </div>
      </div>

      <div class="flex gap-3 justify-center">
        <button onclick="saveResults()" class="px-4 py-2 bg-emerald-500 text-white rounded">Simpan ke Riwayat</button>
        <button onclick="downloadPDF()" class="px-4 py-2 bg-sky-600 text-white rounded">Unduh PDF</button>
        <button onclick="showPage('home')" class="px-4 py-2 border rounded">Kembali ke Beranda</button>
      </div>
    </div>
  </div>

  <!-- HISTORY -->
  <div id="history-page" class="page hidden">
            <div class="max-w-4xl mx-auto px-4 py-8">
                <div class="text-center mb-8 fade-in">
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">Riwayat Tes</h1>
                    <p class="text-gray-600">Lihat kembali hasil tes sebelumnya dan pantau perkembangan</p>
                </div>

                <div id="history-content" class="space-y-4">
                    <!-- Will be populated by JavaScript -->
                </div>

                <div id="no-history" class="text-center py-12 hidden">
                    <div class="text-6xl mb-4">📋</div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">Belum Ada Riwayat</h3>
                    <p class="text-gray-600 mb-6">Anda belum menyelesaikan tes apapun. Mulai tes pertama Anda sekarang!</p>
                    <button onclick="showPage('home')" class="bg-blue-400 hover:bg-blue-500 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                        Mulai Tes
                    </button>
                </div>
            </div>
        </div>

  <!-- RESOURCES -->
  <div id="resources-page" class="page hidden">
            <div class="max-w-4xl mx-auto px-4 py-8">
                <div class="text-center mb-8 fade-in">
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">Sumber Daya</h1>
                    <p class="text-gray-600">Informasi dan tips untuk memahami ADHD lebih baik</p>
                </div>

                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-white rounded-lg p-6 shadow-sm">
                        <h3 class="text-lg font-semibold mb-4">📚 Artikel Edukatif</h3>
                        <div class="space-y-3">
                            <a href="#" class="block p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                                <h4 class="font-medium">Memahami ADHD pada Remaja</h4>
                                <p class="text-sm text-gray-600">Gejala, penyebab, dan cara mengelola ADHD</p>
                            </a>
                            <a href="#" class="block p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                                <h4 class="font-medium">Tips Belajar untuk Siswa ADHD</h4>
                                <p class="text-sm text-gray-600">Strategi efektif meningkatkan fokus belajar</p>
                            </a>
                            <a href="#" class="block p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                                <h4 class="font-medium">Peran Orang Tua dalam Mendukung Anak ADHD</h4>
                                <p class="text-sm text-gray-600">Panduan untuk orang tua dan keluarga</p>
                            </a>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg p-6 shadow-sm">
                        <h3 class="text-lg font-semibold mb-4">🎯 Tips Praktis</h3>
                        <div class="space-y-4">
                            <div class="p-4 bg-blue-50 rounded-lg">
                                <h4 class="font-medium text-blue-800">Untuk Siswa</h4>
                                <ul class="text-sm text-blue-700 mt-2 space-y-1">
                                    <li>• Buat jadwal belajar yang terstruktur</li>
                                    <li>• Gunakan timer untuk sesi fokus pendek</li>
                                    <li>• Eliminasi distraksi saat belajar</li>
                                </ul>
                            </div>
                            <div class="p-4 bg-green-50 rounded-lg">
                                <h4 class="font-medium text-green-800">Untuk Guru</h4>
                                <ul class="text-sm text-green-700 mt-2 space-y-1">
                                    <li>• Berikan instruksi yang jelas dan singkat</li>
                                    <li>• Sediakan break time yang cukup</li>
                                    <li>• Gunakan sistem reward positif</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg p-6 shadow-sm">
                        <h3 class="text-lg font-semibold mb-4">❓ FAQ</h3>
                        <div class="space-y-3">
                            <details class="border border-gray-200 rounded-lg p-3">
                                <summary class="font-medium cursor-pointer">Apakah tes ini dapat mendiagnosis ADHD?</summary>
                                <p class="text-sm text-gray-600 mt-2">Tidak. Tes ini hanya untuk skrining awal. Diagnosis resmi harus dilakukan oleh profesional kesehatan mental.</p>
                            </details>
                            <details class="border border-gray-200 rounded-lg p-3">
                                <summary class="font-medium cursor-pointer">Seberapa akurat hasil tes ini?</summary>
                                <p class="text-sm text-gray-600 mt-2">Tes ini berdasarkan kriteria DSM-5 dan penelitian terkini, namun hasil hanya bersifat indikatif dan perlu konfirmasi profesional.</p>
                            </details>
                            <details class="border border-gray-200 rounded-lg p-3">
                                <summary class="font-medium cursor-pointer">Bagaimana jika hasil menunjukkan indikasi tinggi?</summary>
                                <p class="text-sm text-gray-600 mt-2">Konsultasikan dengan psikolog atau dokter untuk evaluasi lebih lanjut dan rencana penanganan yang tepat.</p>
                            </details>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg p-6 shadow-sm">
                        <h3 class="text-lg font-semibold mb-4">📞 Kontak Profesional</h3>
                        <div class="space-y-3">
                            <div class="p-3 border border-gray-200 rounded-lg">
                                <h4 class="font-medium">Konsultasi Online</h4>
                                <p class="text-sm text-gray-600">Hubungi psikolog bersertifikat untuk konsultasi</p>
                                <button class="mt-2 text-blue-500 text-sm hover:underline">Jadwalkan Konsultasi</button>
                            </div>
                            <div class="p-3 border border-gray-200 rounded-lg">
                                <h4 class="font-medium">Pusat Layanan ADHD</h4>
                                <p class="text-sm text-gray-600">Daftar klinik dan rumah sakit dengan layanan ADHD</p>
                                <button class="mt-2 text-blue-500 text-sm hover:underline">Lihat Daftar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div> <!-- end app -->

<!-- SCRIPTS -->
<script>
/* -----------------------------
   Global state & questionnaire
   ----------------------------- */
let currentPage = 'home';
let assessmentType = 'complete'; // 'complete', 'questionnaire', 'game'
let userProfile = {};
let currentQuestion = 0;
let questionnaireAnswers = {}; // keyed by question id
let gameData = { trials: [], currentLevel:1, currentTrial:0, totalTrials:60, stimulusStartTime:null };

// Questionnaire (18 items) - domain keys: 'inatensi', 'impulsivitas'
const questionnaire = [
  {id:1, domain:'inatensi', text:'Seberapa sering Anda kesulitan memperhatikan detail atau membuat kesalahan ceroboh dalam tugas sekolah?'},
  {id:2, domain:'inatensi', text:'Seberapa sering Anda mengalami kesulitan menjaga fokus saat belajar atau membaca?'},
  {id:3, domain:'inatensi', text:'Seberapa sering Anda merasa tidak mendengarkan ketika seseorang berbicara langsung kepada Anda?'},
  {id:4, domain:'inatensi', text:'Seberapa sering Anda tidak menuntaskan instruksi atau gagal menyelesaikan tugas sekolah/pekerjaan?'},
  {id:5, domain:'inatensi', text:'Seberapa sering Anda kesulitan mengatur pekerjaan atau aktivitas sehari-hari?'},
  {id:6, domain:'inatensi', text:'Seberapa sering Anda menghindari tugas yang memerlukan konsentrasi lama seperti PR atau laporan?'},
  {id:7, domain:'inatensi', text:'Seberapa sering Anda kehilangan barang penting seperti buku, alat tulis, atau kunci?'},
  {id:8, domain:'inatensi', text:'Seberapa sering Anda mudah terdistraksi oleh hal-hal kecil di sekitar Anda?'},
  {id:9, domain:'inatensi', text:'Seberapa sering Anda lupa melakukan kegiatan sehari-hari seperti mengerjakan PR atau membawa barang?'},
  {id:10, domain:'inatensi', text:'Seberapa sering Anda sulit menyelesaikan satu tugas sebelum pindah ke tugas lain?'},
  {id:11, domain:'inatensi', text:'Seberapa sering Anda kesulitan mengikuti penjelasan panjang dari guru atau orang tua?'},
  {id:12, domain:'inatensi', text:'Seberapa sering Anda tidak memperhatikan detail penting dalam instruksi?'},
  {id:13, domain:'inatensi', text:'Seberapa sering pikiran Anda terasa “kemana-mana” saat belajar atau bekerja?'},
  {id:14, domain:'inatensi', text:'Seberapa sering Anda menunda pekerjaan karena merasa sulit untuk memulai?'},
  {id:15, domain:'inatensi', text:'Seberapa sering Anda kesulitan menjaga jadwal atau memenuhi tenggat waktu?'},
  {id:16, domain:'inatensi', text:'Seberapa sering Anda perlu diingatkan berulang kali untuk menyelesaikan sesuatu?'},
  {id:17, domain:'inatensi', text:'Seberapa sering Anda bingung saat harus mengikuti lebih dari satu instruksi sekaligus?'},
  {id:18, domain:'inatensi', text:'Seberapa sering Anda meninggalkan pekerjaan dalam keadaan belum selesai?'},
  {id:19, domain:'impulsivitas', text:'Seberapa sering Anda merasa gelisah atau tidak bisa diam (misalnya mengetuk meja, menggeliat)?'},
  {id:20, domain:'impulsivitas', text:'Seberapa sering Anda meninggalkan tempat duduk padahal seharusnya tetap duduk?'},
  {id:21, domain:'impulsivitas', text:'Seberapa sering Anda merasa sulit untuk tetap tenang saat melakukan aktivitas santai?'},
  {id:22, domain:'impulsivitas', text:'Seberapa sering Anda berbicara berlebihan?'},
  {id:23, domain:'impulsivitas', text:'Seberapa sering Anda menjawab pertanyaan sebelum selesai ditanyakan?'},
  {id:24, domain:'impulsivitas', text:'Seberapa sering Anda kesulitan menunggu giliran?'},
  {id:25, domain:'impulsivitas', text:'Seberapa sering Anda menyela atau mengganggu percakapan/aktivitas orang lain?'},
  {id:26, domain:'impulsivitas', text:'Seberapa sering Anda merasa harus selalu bergerak atau tidak bisa diam?'},
  {id:27, domain:'impulsivitas', text:'Seberapa sering Anda bertindak cepat tanpa memikirkan akibatnya?'},
  {id:28, domain:'impulsivitas', text:'Seberapa sering Anda membuat keputusan spontan yang menimbulkan masalah?'},
  {id:29, domain:'impulsivitas', text:'Seberapa sering Anda tidak sabar saat menunggu atau antre?'},
  {id:30, domain:'impulsivitas', text:'Seberapa sering Anda ikut campur percakapan orang lain tanpa izin?'},
  {id:31, domain:'impulsivitas', text:'Seberapa sering Anda melakukan aktivitas berisiko tanpa mempertimbangkan keselamatan?'},
  {id:32, domain:'impulsivitas', text:'Seberapa sering Anda berbicara atau bertindak pada saat yang tidak tepat?'},
  {id:33, domain:'impulsivitas', text:'Seberapa sering Anda mengganggu aktivitas orang lain karena tidak bisa menahan diri?'}
];


// Navigation
function showPage(name) {
  document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
  const el = document.getElementById(name + '-page');
  if (el) el.classList.remove('hidden');
  currentPage = name;
  window.scrollTo({top:0, behavior:'smooth'});
  // Load history when opening
  if (name === 'history') loadHistory();
}

// Assessment options
function showAssessmentOptions(){
  const el = document.getElementById('assessment-options');
  el.classList.toggle('hidden');
  el.scrollIntoView({behavior:'smooth'});
}
function startCompleteAssessment(){ assessmentType='complete'; showPage('onboarding'); }
function startQuestionnaireOnly(){ assessmentType='questionnaire'; showPage('onboarding'); }
function startGameOnly(){ assessmentType='game'; showPage('onboarding'); }

// Onboarding form
document.getElementById('onboarding-form').addEventListener('submit', function(e){
  e.preventDefault();
  userProfile = {
    nickname: document.getElementById('nickname').value || 'Anon',
    age: parseInt(document.getElementById('age').value || '0', 10),
    sessionId: 'session_' + Date.now(),
    startTime: new Date().toISOString(),
    assessmentType: assessmentType
  };
  // route to next step
  if (assessmentType === 'game') {
    showPage('game');
  } else {
    showPage('questionnaire');
    currentQuestion = 0;
    questionnaireAnswers = {};
    loadQuestion();
  }
});

/* -----------------------------
   Questionnaire UI & logic
   ----------------------------- */
function loadQuestion(){
  const q = questionnaire[currentQuestion];
  document.getElementById('question-text').textContent = q.text;
  document.getElementById('progress-text').textContent = `${currentQuestion+1} / ${questionnaire.length}`;
  document.getElementById('progress-bar').style.width = `${((currentQuestion+1)/questionnaire.length)*100}%`;
  const container = document.getElementById('answer-options');
  container.innerHTML = '';

  const labels = ['Tidak Pernah', 'Kadang-kadang', 'Sering', 'Sangat Sering'];
  labels.forEach((lbl, idx) => {
    const btn = document.createElement('button');
    btn.className = 'w-full text-left p-3 border rounded hover:bg-sky-50 transition';
    btn.innerHTML = `<div class="flex justify-between items-center"><div>${lbl}</div><div class="text-sm text-gray-400">(${idx})</div></div>`;
    btn.onclick = () => { selectAnswer(idx); };
    container.appendChild(btn);
  });

  // restore selection
  if (questionnaireAnswers[q.id] !== undefined) {
    highlightAnswer(questionnaireAnswers[q.id]);
    document.getElementById('next-btn').disabled = false;
  } else {
    document.getElementById('next-btn').disabled = true;
  }

  document.getElementById('prev-btn').disabled = currentQuestion === 0;
}

function selectAnswer(value){
  const q = questionnaire[currentQuestion];
  questionnaireAnswers[q.id] = value;
  highlightAnswer(value);
  document.getElementById('next-btn').disabled = false;
}

function highlightAnswer(value){
  document.querySelectorAll('#answer-options button').forEach((b,i) => {
    b.classList.remove('bg-sky-100','border-sky-400');
    if (i === value) {
      b.classList.add('bg-sky-100','border-sky-400');
    }
  });
}

function nextQuestion(){
  if (currentQuestion < questionnaire.length - 1) {
    currentQuestion++;
    loadQuestion();
  } else {
    // end of questionnaire
    if (assessmentType === 'questionnaire') {
      showResults();
    } else if (assessmentType === 'complete') {
      // go to game after questionnaire
      showPage('game');
    } else {
      showResults();
    }
  }
}
function previousQuestion(){
  if (currentQuestion > 0) {
    currentQuestion--;
    loadQuestion();
  }
}

/* -----------------------------
   Game: Focus Catcher
   ----------------------------- */
let gameIntervalHandler = null;
let activeTimeout = null;
function startGame(){
  document.getElementById('game-instructions').classList.add('hidden');
  document.getElementById('game-area').classList.remove('hidden');
  document.getElementById('game-complete').classList.add('hidden');

  gameData = { trials: [], currentLevel:1, currentTrial:0, totalTrials:60, stimulusStartTime:null };

  document.addEventListener('keydown', handleKeyPress);
  setTimeout(runTrial, 800);
}

function runTrial(){
  if (gameData.currentTrial >= gameData.totalTrials) {
    endGame();
    return;
  }
  // update UI
  const lvl = gameData.currentTrial < 20 ? 1 : gameData.currentTrial < 40 ? 2 : 3;
  gameData.currentLevel = lvl;
  document.getElementById('level-indicator').textContent = `Level ${lvl}`;
  document.getElementById('trial-counter').textContent = `Trial ${gameData.currentTrial+1}/${gameData.totalTrials}`;
  document.getElementById('game-progress').style.width = `${(gameData.currentTrial/gameData.totalTrials)*100}%`;

  // fixation
  document.getElementById('fixation-cross').classList.remove('hidden');
  document.getElementById('stimulus').classList.add('hidden');
  document.getElementById('feedback').classList.add('hidden');

  // show stimulus after short random delay
  clearTimeout(activeTimeout);
  activeTimeout = setTimeout(() => {
    showStimulus();
  }, 400 + Math.random()*800);
}

function showStimulus(){
  const isTarget = Math.random() < 0.7; // 70% target
  const stim = document.getElementById('stimulus');
  document.getElementById('fixation-cross').classList.add('hidden');
  stim.classList.remove('hidden');
  if (isTarget) {
    stim.className = 'game-stimulus mx-auto target';
    stim.textContent = 'GO';
  } else {
    stim.className = 'game-stimulus mx-auto distractor';
    stim.textContent = 'NO';
  }
  gameData.stimulusStartTime = Date.now();
  gameData.currentStimulus = { type: isTarget ? 'target' : 'distractor', startTime: gameData.stimulusStartTime, responded:false, reactionTime:null };

  // hide stimulus automatically after 1400ms if not responded
  activeTimeout = setTimeout(()=> {
    if (!gameData.currentStimulus.responded) handleResponse(false);
  }, 1400);
}

function handleKeyPress(e){
  if (e.code === 'Space') {
    e.preventDefault();
    if (gameData.currentStimulus && !gameData.currentStimulus.responded) {
      handleResponse(true);
    }
  }
}

function handleResponse(pressed){
  if (!gameData.currentStimulus || gameData.currentStimulus.responded) return;
  gameData.currentStimulus.responded = true;
  const rt = pressed ? Date.now() - gameData.currentStimulus.startTime : null;

  const trial = {
    trial: gameData.currentTrial,
    level: gameData.currentLevel,
    stimulusType: gameData.currentStimulus.type,
    response: pressed,
    reactionTime: rt,
    correct: (gameData.currentStimulus.type === 'target' && pressed) || (gameData.currentStimulus.type === 'distractor' && !pressed),
    timestamp: Date.now()
  };
  gameData.trials.push(trial);

  // feedback
  const feedback = document.getElementById('feedback');
  if (trial.correct) {
    feedback.textContent = '✓ Benar';
    feedback.className = 'mt-4 text-lg font-medium text-green-600';
  } else {
    feedback.textContent = '✗ Salah';
    feedback.className = 'mt-4 text-lg font-medium text-red-600';
  }
  feedback.classList.remove('hidden');
  document.getElementById('stimulus').classList.add('hidden');

  gameData.currentTrial++;
  clearTimeout(activeTimeout);
  setTimeout(runTrial, 700);
}

function endGame(){
  document.removeEventListener('keydown', handleKeyPress);
  document.getElementById('game-area').classList.add('hidden');
  document.getElementById('game-complete').classList.remove('hidden');
}

/* -----------------------------
   Results & Charts (FIX: domain chart + explanations)
   ----------------------------- */
let radarChartInstance = null;
let performanceChartInstance = null;

function showResults(){
  showPage('results');
  calculateResults();
}

function calculateResults(){
  // compute domain scores
  const domainScores = { inatensi:0, impulsivitas:0, consistency:0 };
  let inattentionScore = 0;
  let impulsivityScore = 0;
  // Sum questionnaire answers (0..3) grouped by domain
  questionnaire.forEach(q => {
    const val = Number(questionnaireAnswers[q.id] || 0);
    if (q.domain === 'inatensi') { domainScores.inatensi += val; inattentionScore += val; }
    if (q.domain === 'impulsivitas') { domainScores.impulsivitas += val; impulsivityScore += val; }
  });

  // compute game-based consistency & accuracy if trials exist
  let hits = 0, misses = 0, falseAlarms = 0, correctRejections = 0, avgRT = 0, accuracy = 0;
  if (gameData.trials && gameData.trials.length > 0) {
    const trials = gameData.trials;
    const correctTrials = trials.filter(t => t.correct);
    const targetTrials = trials.filter(t => t.stimulusType === 'target');
    const distractorTrials = trials.filter(t => t.stimulusType === 'distractor');

    hits = targetTrials.filter(t => t.response).length;
    misses = targetTrials.filter(t => !t.response).length;
    falseAlarms = distractorTrials.filter(t => t.response).length;
    correctRejections = distractorTrials.filter(t => !t.response).length;

    accuracy = trials.length ? Math.round((correctTrials.length / trials.length) * 100) : 0;
    const rtList = targetTrials.filter(t => t.response && t.reactionTime).map(t => t.reactionTime);
    avgRT = rtList.length ? Math.round(rtList.reduce((a,b)=>a+b,0)/rtList.length) : 0;

    // consistency: 1 - (std / mean) scaled to 0..100 (simple)
    if (rtList.length > 1) {
      const mean = rtList.reduce((a,b)=>a+b,0)/rtList.length;
      const variance = rtList.reduce((s,rt)=>s+Math.pow(rt-mean,2),0)/rtList.length;
      const std = Math.sqrt(variance);
      domainScores.consistency = Math.max(0, Math.min(100, Math.round((1 - (std/mean))*100)));
    } else {
      domainScores.consistency = 80; // default neutral
    }
  } else {
    domainScores.consistency = 80; // default value when no game
  }

  // Update summary numbers
  document.getElementById('inattention-score').textContent = inattentionScore;
  document.getElementById('impulsivity-score').textContent = impulsivityScore;
  document.getElementById('consistency-score').textContent = Math.round(domainScores.consistency);

  document.getElementById('total-trials').textContent = gameData.trials ? gameData.trials.length : 0;
  document.getElementById('correct-hits').textContent = hits;
  document.getElementById('false-alarms').textContent = falseAlarms;
  document.getElementById('avg-reaction-time').textContent = avgRT ? (avgRT + ' ms') : '—';

  // Now render domain chart + explanation in #domainResults
  renderDomainChartAndExplanation(domainScores);

  // render performance chart (grouped)
  renderPerformanceChart();

  // generate interpretation & recommendations
  generateInterpretation(inattentionScore, impulsivityScore, domainScores.consistency, accuracy);
  generateRecommendations(inattentionScore, impulsivityScore, domainScores.consistency);

  // persist summary to localStorage (history)
  const results = {
    timestamp: new Date().toISOString(),
    sessionId: userProfile.sessionId || ('session_'+Date.now()),
    assessmentType: assessmentType,
    userProfile,
    scores: {
      inattention: inattentionScore,
      impulsivity: impulsivityScore,
      consistency: Math.round(domainScores.consistency),
      accuracy: accuracy,
      avgReactionTime: avgRT
    },
    statistics: {
      totalTrials: gameData.trials ? gameData.trials.length : 0,
      hits, misses, falseAlarms, correctRejections
    },
    questionnaire: questionnaireAnswers,
    gameData: gameData
  };
  const hist = JSON.parse(localStorage.getItem('itention_history') || '[]');
  hist.unshift(results);
  localStorage.setItem('itention_history', JSON.stringify(hist.slice(0,10)));
}

/* Render domain chart + textual explanation under #domainResults */
function renderDomainChartAndExplanation(domainScores){
  const container = document.getElementById('domainResults');
  container.innerHTML = `
    <canvas id="domainChart" style="max-width:100%;max-height:320px"></canvas>
    <div id="domainExplanation" class="mt-3 text-sm text-gray-700"></div>
  `;
  // destroy previous chart if exists
  if (radarChartInstance) {
    try { radarChartInstance.destroy(); } catch(e){}
    radarChartInstance = null;
  const container = document.getElementById('domainResults');
  container.innerHTML = `
    <canvas id="domainChart" style="max-width:100%;max-height:320px"></canvas>
    <div id="domainExplanation" class="mt-3 text-sm text-gray-700"></div>
  `;
  }

  const labels = ['Inatensi','Impulsivitas','Konsistensi'];
  // For plotting, scale inatensi & impulsivitas so they're comparable to 0..30 range:
  // In questionnaire we had up to 9 items per domain? In our 18-items split approx 9 and 9 -> each option 0..3 -> max 27.
  // We'll plot raw domainScores (they're already in 0..27-ish) and consistency (0..100) scaled to 0..27 for visual comparability.
  const inScore = domainScores.inatensi || 0;
  const impScore = domainScores.impulsivitas || 0;
  // scale consistency (0..100) to 0..27
  const consistencyScaled = Math.round((domainScores.consistency || 80)/100 * 27);

  const ctx = document.getElementById('domainChart').getContext('2d');
  radarChartInstance = new Chart(ctx, {
    type: 'radar',
    data: {
      labels,
      datasets: [{
        label: 'Profil Anda',
        data: [inScore, impScore, consistencyScaled],
        backgroundColor: 'rgba(37,99,235,0.18)',
        borderColor: 'rgba(37,99,235,1)',
        pointBackgroundColor: 'rgba(37,99,235,1)',
        borderWidth: 2
      }]
    },
    options: {
      responsive:true,
      maintainAspectRatio:false,
      scales: {
        r: {
          beginAtZero:true,
          max:51,
          ticks: { stepSize:10 }
        }
      },
      plugins: { legend: { display:false } }
    }
  });

  // explanation text
  const explanations = {
    'Inatensi': 'Menunjukkan tingkat kesulitan mempertahankan perhatian—mudah terdistraksi, lupa, atau tidak menyelesaikan tugas.',
    'Impulsivitas': 'Menggambarkan tindakan cepat tanpa pertimbangan—menyela, sulit menunggu giliran, bertindak impulsif.',
    'Konsistensi': 'Menggambarkan stabilitas performa (dari permainan). Nilai lebih tinggi berarti performa lebih stabil.'
  };

  const explanationHtml = `
    <h4 class="font-semibold mb-2">Apa arti grafik ini?</h4>
    <ul class="list-disc pl-5 space-y-2">
      <li><strong>Inatensi:</strong> Skor ${inScore} — ${explanations['Inatensi']}</li>
      <li><strong>Impulsivitas:</strong> Skor ${impScore} — ${explanations['Impulsivitas']}</li>
      <li><strong>Konsistensi:</strong> Skor ${Math.round(domainScores.consistency)} — ${explanations['Konsistensi']}</li>
    </ul>
    <div class="text-xs text-gray-500 mt-2">Catatan: Skor inatensi & impulsivitas berasal dari kuesioner (skor maksimum ~27). Konsistensi dihitung dari variasi waktu reaksi permainan (0–100).</div>
  `;
  document.getElementById('domainExplanation').innerHTML = explanationHtml;
}

/* Performance chart creation */
function renderPerformanceChart(){
  // destroy previous
  if (performanceChartInstance) { try { performanceChartInstance.destroy(); } catch(e){} performanceChartInstance = null; }
  const ctx = document.getElementById('performanceChart').getContext('2d');

  // if no trials, clear canvas
  if (!gameData.trials || gameData.trials.length === 0) {
    ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);
    // optional: show placeholder text
    ctx.fillStyle = '#94a3b8';
    ctx.font = '14px Inter, sans-serif';
    ctx.fillText('Hasil permainan akan ditampilkan di sini jika Anda memainkan Focus Catcher.', 10, 30);
    return;
  }

  // group by blocks of 10 trials
  const blockSize = 10;
  const blocks = [];
  const accuracyData = [];
  const rtData = [];
  for (let i=0; i<gameData.trials.length; i+=blockSize){
    const blk = gameData.trials.slice(i, i+blockSize);
    const acc = blk.length ? (blk.filter(t=>t.correct).length / blk.length) * 100 : 0;
    const rtList = blk.filter(t=>t.response && t.reactionTime).map(t=>t.reactionTime);
    const avgRt = rtList.length ? (rtList.reduce((a,b)=>a+b,0)/rtList.length) : 0;
    blocks.push(`Blok ${Math.floor(i/blockSize)+1}`);
    accuracyData.push(Math.round(acc));
    rtData.push(Math.round(avgRt));
  }

  performanceChartInstance = new Chart(ctx, {
    type: 'line',
    data: {
      labels: blocks,
      datasets: [
        { label:'Akurasi (%)', data: accuracyData, borderColor:'#06b6d4', backgroundColor:'rgba(6,182,212,0.12)', yAxisID:'y' },
        { label:'Waktu Reaksi (ms)', data: rtData, borderColor:'#ef4444', backgroundColor:'rgba(239,68,68,0.08)', yAxisID:'y1' }
      ]
    },
    options: {
      responsive:true, maintainAspectRatio:false,
      scales: {
        y: { type:'linear', position:'left', title:{display:true, text:'Akurasi (%)'} },
        y1: { type:'linear', position:'right', title:{display:true, text:'RT (ms)'}, grid:{drawOnChartArea:false} }
      }
    }
  });
}

/* Interpretation & recommendations */
function generateInterpretation(inatt, imp, consistency, accuracy){
  const container = document.getElementById('interpretation-content');
  container.innerHTML = '';
  const inRisk = inatt >= 34 ? 'tinggi' : inatt >= 22 ? 'sedang' : 'rendah';
  const impRisk = imp >= 34 ? 'tinggi' : imp >= 22 ? 'sedang' : 'rendah';
  const consRisk = consistency < 60 ? 'tidak stabil' : consistency < 80 ? 'sedang' : 'stabil';

  const html = `
    <div class="space-y-3">
      <div><strong>Inatensi:</strong> tingkat ${inRisk}. ${inRisk==='tinggi' ? 'Pertimbangkan evaluasi lebih lanjut.' : inRisk==='sedang' ? 'Perhatikan strategi manajemen perhatian.' : 'Performa perhatian relatif baik.'}</div>
      <div><strong>Impulsivitas:</strong> tingkat ${impRisk}. ${impRisk==='tinggi' ? 'Kontrol impuls perlu diperhatikan.' : impRisk==='sedang' ? 'Beberapa tanda impulsivitas terlihat.' : 'Kontrol impuls relatif baik.'}</div>
      <div><strong>Konsistensi:</strong> performa ${consRisk} (${Math.round(consistency)}%). ${consRisk==='tidak stabil' ? 'Variasi RT tinggi, konsentrasi fluktuatif.' : consRisk==='sedang' ? 'Beberapa variabilitas.' : 'Konsisten.'}</div>
      <div class="text-xs text-gray-500 mt-2">⚠️ Ini hanyalah skrining. Diagnosis hanya dapat diberikan oleh profesional kesehatan mental.</div>
    </div>
  `;
  container.innerHTML = html;
}

function generateRecommendations(inatt, imp, consistency){
  const container = document.getElementById('recommendations-content');
  container.innerHTML = '';
  const overall = Math.max(inatt >= 18 ? 3 : inatt >= 12 ? 2 : 1,
                           imp >= 18 ? 3 : imp >= 12 ? 2 : 1,
                           consistency < 60 ? 3 : consistency < 80 ? 2 : 1);

  const recs = overall === 3 ? [
    {title:'Konsultasi Profesional', text:'Sangat disarankan untuk berkonsultasi dengan psikolog/psikiater.'},
    {title:'Evaluasi Lanjut', text:'Evaluasi klinis lengkap untuk diagnosis dan rencana intervensi.'}
  ] : overall === 2 ? [
    {title:'Pengamatan & Dukungan', text:'Diskusikan dengan guru/orang tua; terapkan strategi pengelolaan perhatian.'},
    {title:'Uji Tindak Lanjut', text:'Lakukan pemantauan berkala.'}
  ] : [
    {title:'Pertahankan Praktik Baik', text:'Lanjutkan teknik pengelolaan waktu dan fokus.'}
  ];

  recs.forEach(r => {
    const div = document.createElement('div');
    div.className = 'mb-3';
    div.innerHTML = `<div class="font-semibold">${r.title}</div><div class="text-sm text-gray-600">${r.text}</div>`;
    container.appendChild(div);
  });
}

/* Save & download (placeholders) */
function saveResults(){
  alert('Hasil disimpan ke riwayat (lokal).');
}
function downloadPDF(){
  alert('Fitur download PDF belum aktif. Gunakan Print -> Save as PDF dari browser.');
}

/* History */
function loadHistory() {
            const history = JSON.parse(localStorage.getItem('itention_history') || '[]');
            const container = document.getElementById('history-content');
            const noHistory = document.getElementById('no-history');

            if (history.length === 0) {
                container.innerHTML = '';
                noHistory.classList.remove('hidden');
                return;
            }

            noHistory.classList.add('hidden');
            container.innerHTML = '';

            history.forEach((result, index) => {
                const date = new Date(result.timestamp).toLocaleDateString('id-ID', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                const overallRisk = Math.max(
                    result.scores.inattention >= 18 ? 3 : result.scores.inattention >= 12 ? 2 : 1,
                    result.scores.impulsivity >= 18 ? 3 : result.scores.impulsivity >= 12 ? 2 : 1,
                    result.scores.consistency < 60 ? 3 : result.scores.consistency < 80 ? 2 : 1
                );

                const riskLevel = overallRisk === 3 ? 'Tinggi' : overallRisk === 2 ? 'Sedang' : 'Rendah';
                const riskColor = overallRisk === 3 ? 'text-red-600 bg-red-100' : 
                                overallRisk === 2 ? 'text-orange-600 bg-orange-100' : 
                                'text-green-600 bg-green-100';

                const assessmentTypeLabel = result.assessmentType === 'complete' ? 'Lengkap' : 
                                           result.assessmentType === 'questionnaire' ? 'Kuesioner' : 'Focus Catcher';

                const div = document.createElement('div');
                div.className = 'bg-white rounded-lg p-6 shadow-sm border';
                div.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">Tes #${history.length - index}</h3>
                            <p class="text-sm text-gray-600">${date}</p>
                            <span class="inline-block px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full mt-1">
                                ${assessmentTypeLabel}
                            </span>
                        </div>
                        <span class="px-3 py-1 rounded-full text-sm font-medium ${riskColor}">
                            Risiko ${riskLevel}
                        </span>
                    </div>
                    
                    <div class="grid md:grid-cols-4 gap-4 mb-4">
                        ${result.assessmentType !== 'game' ? `
                        <div class="text-center p-3 bg-gray-50 rounded-lg">
                            <div class="text-xl font-bold text-blue-500">${result.scores.inattention}</div>
                            <p class="text-xs text-gray-600">Inatensi</p>
                        </div>
                        <div class="text-center p-3 bg-gray-50 rounded-lg">
                            <div class="text-xl font-bold text-orange-500">${result.scores.impulsivity}</div>
                            <p class="text-xs text-gray-600">Impulsivitas</p>
                        </div>` : ''}
                        ${result.assessmentType !== 'questionnaire' ? `
                        <div class="text-center p-3 bg-gray-50 rounded-lg">
                            <div class="text-xl font-bold text-teal-500">${result.scores.consistency}</div>
                            <p class="text-xs text-gray-600">Konsistensi</p>
                        </div>
                        <div class="text-center p-3 bg-gray-50 rounded-lg">
                            <div class="text-xl font-bold text-purple-500">${result.scores.accuracy}%</div>
                            <p class="text-xs text-gray-600">Akurasi Game</p>
                        </div>` : ''}
                    </div>
                    
                    <div class="flex space-x-3">
                        <button onclick="viewHistoryDetail(${index})" class="text-blue-500 hover:text-blue-600 text-sm font-medium">
                            Lihat Detail
                        </button>
                        <button onclick="deleteHistoryItem(${index})" class="text-red-500 hover:text-red-600 text-sm font-medium">
                            Hapus
                        </button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function viewHistoryDetail(index) {
            const history = JSON.parse(localStorage.getItem('itention_history') || '[]');
            const result = history[index];
            
            if (!result) return;

            // Store the selected result temporarily and show results page
            window.selectedHistoryResult = result;
            showHistoryResults(result);
        }

        function showHistoryResults(result) {
            // Temporarily replace current data with history data
            const originalAnswers = questionnaireAnswers;
            const originalGameData = gameData;
            const originalUserProfile = userProfile;

            questionnaireAnswers = result.questionnaire;
            gameData = result.gameData;
            userProfile = result.userProfile;

            showPage('results');
            
            // Update display with historical data
            document.getElementById('inattention-score').textContent = result.scores.inattention;
            document.getElementById('impulsivity-score').textContent = result.scores.impulsivity;
            document.getElementById('consistency-score').textContent = result.scores.consistency;

            document.getElementById('total-trials').textContent = result.statistics.totalTrials;
            document.getElementById('correct-hits').textContent = result.statistics.hits;
            document.getElementById('false-alarms').textContent = result.statistics.falseAlarms;
            document.getElementById('avg-reaction-time').textContent = result.scores.avgReactionTime + 'ms';

            // Recreate charts with historical data
            createRadarChart(result.scores.inattention, result.scores.impulsivity, result.scores.consistency);
            createPerformanceChart();

            // Generate interpretation and recommendations
            generateInterpretation(result.scores.inattention, result.scores.impulsivity, result.scores.consistency, result.scores.accuracy / 100);
            generateRecommendations(result.scores.inattention, result.scores.impulsivity, result.scores.consistency);

            // Add a note that this is historical data
            const resultsPage = document.getElementById('results-page');
            let historyNote = resultsPage.querySelector('.history-note');
            if (!historyNote) {
                historyNote = document.createElement('div');
                historyNote.className = 'history-note bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6';
                historyNote.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <span class="text-blue-500">📋</span>
                        <span class="text-blue-800 font-medium">Ini adalah data historis dari tes sebelumnya</span>
                    </div>
                `;
                resultsPage.querySelector('.max-w-6xl').insertBefore(historyNote, resultsPage.querySelector('.text-center'));
            }

            // Restore original data
            setTimeout(() => {
                questionnaireAnswers = originalAnswers;
                gameData = originalGameData;
                userProfile = originalUserProfile;
            }, 100);
        }

        function deleteHistoryItem(index) {
            if (confirm('Apakah Anda yakin ingin menghapus hasil tes ini?')) {
                const history = JSON.parse(localStorage.getItem('itention_history') || '[]');
                history.splice(index, 1);
                localStorage.setItem('itention_history', JSON.stringify(history));
                loadHistory();
            }
        }

/* Initialize to home */
showPage('home');
</script>

</body>
</html>
